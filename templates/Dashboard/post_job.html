{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>Post a Job - Smart Hire Hub</title>
    <link rel="stylesheet" href="{% static 'css/recuriter.css' %}">
    <link rel="stylesheet" href="{% static 'css/post_job.css' %}">
    <script defer src="{% static 'js/dashboard.js' %}"></script>
</head>
<body>

<div class="layout">

    <!-- SIDEBAR -->
    <aside class="sidebar">
        <h2>Recruiter</h2>
        <ul class="menu">
            <li>
                <a href="{% url 'recruiter_dashboard' %}">Dashboard</a>
            </li>
            <li>
                <a href="{% url 'post_job' %}" class="active">Post Job</a>
            </li>
            <li>
                <a href="#">My Jobs</a>
            </li>
            <li>
                <a href="#">Applications</a>
            </li>
            <li>
                <a href="{% url 'recruiter_account_settings' %}">Settings</a>
            </li>
        </ul>
    </aside>

    <!-- MAIN -->
    <main class="main">
        {% include "layouts/header.html" %}
        
        <!-- PAGE HEADER -->
        <div class="page-header">
            <div class="header-content">
                <h1>Post a New Job</h1>
                <p>Fill in the details below to create an attractive job posting</p>
            </div>
            <div class="header-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                    <line x1="16" y1="13" x2="8" y2="13"></line>
                    <line x1="16" y1="17" x2="8" y2="17"></line>
                </svg>
            </div>
        </div>

        <!-- JOB POSTING FORM -->
        <form class="job-form" id="postJobForm">
            {% csrf_token %}
            
            <div class="form-grid">
                <!-- Job Title -->
                <div class="form-group full-width">
                    <label for="job_title" class="form-label">
                        <span class="label-text">Job Title</span>
                        <span class="required">*</span>
                    </label>
                    <input 
                        type="text" 
                        id="job_title" 
                        name="job_title" 
                        class="form-input" 
                        placeholder="e.g., Senior Software Engineer"
                        required
                    >
                    <span class="input-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                            <circle cx="9" cy="7" r="4"></circle>
                            <path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                        </svg>
                    </span>
                </div>

                <!-- Location -->
                <div class="form-group">
                    <label for="location" class="form-label">
                        <span class="label-text">Location</span>
                        <span class="required">*</span>
                    </label>
                    <input 
                        type="text" 
                        id="location" 
                        name="location" 
                        class="form-input" 
                        placeholder="e.g., New York, NY"
                        required
                    >
                    <span class="input-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                            <circle cx="12" cy="10" r="3"></circle>
                        </svg>
                    </span>
                </div>

                <!-- Job Type -->
                <div class="form-group">
                    <label for="job_type" class="form-label">
                        <span class="label-text">Job Type</span>
                        <span class="required">*</span>
                    </label>
                    <select id="job_type" name="job_type" class="form-input" required>
                        <option value="">Select job type</option>
                        <option value="full-time">Full Time</option>
                        <option value="part-time">Part Time</option>
                        <option value="contract">Contract</option>
                        <option value="internship">Internship</option>
                        <option value="remote">Remote</option>
                        <option value="hybrid">Hybrid</option>
                    </select>
                    <span class="input-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                            <line x1="3" y1="10" x2="21" y2="10"></line>
                        </svg>
                    </span>
                </div>

                <!-- Salary Range (Optional but attractive) -->
                <div class="form-group">
                    <label for="salary_min" class="form-label">
                        <span class="label-text">Salary Range (Min)</span>
                        <span class="currency-label">in ₹</span>
                    </label>
                    <div class="salary-input-wrapper">
                        <span class="currency-prefix">₹</span>
                        <input 
                            type="number" 
                            id="salary_min" 
                            name="salary_min" 
                            class="form-input salary-input" 
                            placeholder="50000"
                            min="0"
                        >
                    </div>
                    <span class="input-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="12" y1="1" x2="12" y2="23"></line>
                            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                        </svg>
                    </span>
                </div>

                <div class="form-group">
                    <label for="salary_max" class="form-label">
                        <span class="label-text">Salary Range (Max)</span>
                        <span class="currency-label">in ₹</span>
                    </label>
                    <div class="salary-input-wrapper">
                        <span class="currency-prefix">₹</span>
                        <input 
                            type="number" 
                            id="salary_max" 
                            name="salary_max" 
                            class="form-input salary-input" 
                            placeholder="80000"
                            min="0"
                        >
                    </div>
                    <span class="input-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="12" y1="1" x2="12" y2="23"></line>
                            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                        </svg>
                    </span>
                </div>

                <!-- Experience Level -->
                <div class="form-group">
                    <label for="experience_level" class="form-label">
                        <span class="label-text">Experience Level</span>
                    </label>
                    <select id="experience_level" name="experience_level" class="form-input">
                        <option value="">Select experience level</option>
                        <option value="entry">Entry Level</option>
                        <option value="mid">Mid Level</option>
                        <option value="senior">Senior Level</option>
                        <option value="executive">Executive</option>
                    </select>
                    <span class="input-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                        </svg>
                    </span>
                </div>

                <!-- Expiry Date -->
                <div class="form-group">
                    <label for="expiry_date" class="form-label">
                        <span class="label-text">Expiry Date</span>
                        <span class="required">*</span>
                    </label>
                    <input 
                        type="date" 
                        id="expiry_date" 
                        name="expiry_date" 
                        class="form-input" 
                        required
                        min=""
                    >
                    <span class="input-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                            <line x1="3" y1="10" x2="21" y2="10"></line>
                        </svg>
                    </span>
                </div>

                <!-- Job Description -->
                <div class="form-group full-width">
                    <label for="description" class="form-label">
                        <span class="label-text">Job Description</span>
                        <span class="required">*</span>
                    </label>
                    <span class="input-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <line x1="16" y1="13" x2="8" y2="13"></line>
                            <line x1="16" y1="17" x2="8" y2="17"></line>
                        </svg>
                    </span>
                    <textarea 
                        id="description" 
                        name="description" 
                        class="form-textarea" 
                        rows="8"
                        placeholder="Describe the role, responsibilities, and requirements..."
                        required
                    ></textarea>
                    <div class="char-count">
                        <span id="charCount">0</span> / 2000 characters
                    </div>
                </div>

                <!-- Requirements -->
                <div class="form-group full-width">
                    <label for="requirements" class="form-label">
                        <span class="label-text">Requirements & Qualifications</span>
                    </label>
                    <span class="input-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="9 11 12 14 22 4"></polyline>
                            <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
                        </svg>
                    </span>
                    <textarea 
                        id="requirements" 
                        name="requirements" 
                        class="form-textarea" 
                        rows="6"
                        placeholder="List the required skills, qualifications, and experience..."
                    ></textarea>
                </div>

                <!-- Benefits (Optional but attractive) -->
                <div class="form-group full-width">
                    <label for="benefits" class="form-label">
                        <span class="label-text">Benefits & Perks</span>
                    </label>
                    <span class="input-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                        </svg>
                    </span>
                    <textarea 
                        id="benefits" 
                        name="benefits" 
                        class="form-textarea" 
                        rows="4"
                        placeholder="e.g., Health insurance, 401(k), Flexible hours, Remote work..."
                    ></textarea>
                </div>
            </div>

            <!-- FORM ACTIONS -->
            <div class="form-actions">
                <button type="button" class="btn-secondary" onclick="window.location.href='{% url 'recruiter_dashboard' %}'">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M19 12H5M12 19l-7-7 7-7"></path>
                    </svg>
                    Cancel
                </button>
                <button type="submit" class="btn-primary">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                        <polyline points="17 21 17 13 7 13 7 21"></polyline>
                        <polyline points="7 3 7 8 15 8"></polyline>
                    </svg>
                    Post Job
                </button>
            </div>
        </form>
    </main>

</div>

<script>
    // Set minimum date to today
    document.addEventListener('DOMContentLoaded', function() {
        const expiryDateInput = document.getElementById('expiry_date');
        const today = new Date().toISOString().split('T')[0];
        expiryDateInput.setAttribute('min', today);
        
        // Character counter for description
        const descriptionTextarea = document.getElementById('description');
        const charCount = document.getElementById('charCount');
        
        descriptionTextarea.addEventListener('input', function() {
            const count = this.value.length;
            charCount.textContent = count;
            
            if (count > 2000) {
                charCount.style.color = '#ef4444';
            } else if (count > 1800) {
                charCount.style.color = '#f59e0b';
            } else {
                charCount.style.color = '#64748b';
            }
        });
        
        // Form submission - API call
        document.getElementById('postJobForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitButton = this.querySelector('button[type="submit"]');
            const originalButtonText = submitButton.innerHTML;
            
            // Disable submit button and show loading state
            submitButton.disabled = true;
            submitButton.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="animation: spin 1s linear infinite;">
                    <path d="M21 12a9 9 0 1 1-6.219-8.56"></path>
                </svg>
                Posting...
            `;
            
            try {
                // Get form data
                const formData = new FormData(this);
                const data = {};
                
                // Convert FormData to object
                for (let [key, value] of formData.entries()) {
                    if (value.trim() !== '') {
                        data[key] = value.trim();
                    }
                }
                
                // Get CSRF token
                function getCookie(name) {
                    let cookieValue = null;
                    if (document.cookie && document.cookie !== '') {
                        const cookies = document.cookie.split(';');
                        for (let i = 0; i < cookies.length; i++) {
                            const cookie = cookies[i].trim();
                            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                break;
                            }
                        }
                    }
                    return cookieValue;
                }
                
                const csrftoken = getCookie('csrftoken');
                
                // Make API call
                const response = await fetch('{% url "save_job" %}', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': csrftoken
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (response.ok && result.success) {
                    // Show success message
                    alert('Job posted successfully!');
                    // Reset form
                    this.reset();
                    document.getElementById('charCount').textContent = '0';
                    // Optionally redirect to dashboard or job list
                    // window.location.href = '{% url "recruiter_dashboard" %}';
                } else {
                    // Show error message
                    alert(result.error || 'Failed to post job. Please try again.');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('An error occurred while posting the job. Please try again.');
            } finally {
                // Re-enable submit button
                submitButton.disabled = false;
                submitButton.innerHTML = originalButtonText;
            }
        });
        
        // Add spinner animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes spin {
                from { transform: rotate(0deg); }
                to { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(style);
    });
</script>

</body>
</html>
